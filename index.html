<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Climix</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2196f3">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
 font-family:Segoe UI,sans-serif;
 min-height:100vh;
 display:flex;
 justify-content:center;
 background:linear-gradient(160deg,#2193b0,#6dd5ed);
 color:#fff
}
.app{
 width:100%;
 max-width:420px;
 padding:16px;
 border-radius:30px;
 backdrop-filter:blur(18px);
 background:rgba(255,255,255,.15);
 box-shadow:0 20px 40px rgba(0,0,0,.3)
}
.card{
 margin-bottom:14px;
 padding:16px;
 border-radius:22px;
 background:rgba(255,255,255,.18)
}
.center{text-align:center}
.icon{font-size:64px}
.temp{font-size:48px;font-weight:bold}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.box{
 padding:12px;
 border-radius:16px;
 background:rgba(0,0,0,.15);
 text-align:center
}
canvas{width:100%;height:160px}
.week-scroll{display:flex;gap:12px;overflow-x:auto}
.week-card{
 min-width:80px;
 padding:10px;
 border-radius:16px;
 text-align:center;
 background:linear-gradient(135deg,#42a5f5,#478ed1)
}
input,button{
 width:100%;
 padding:12px;
 border-radius:14px;
 border:none;
 font-size:16px
}
button{background:#2196f3;color:#fff;margin-top:6px}
footer{text-align:center;font-size:12px;opacity:.7}
</style>
</head>

<body>
<div class="app">

<div class="card center">
  <h2>Climix</h2>
</div>

<div class="card">
  <input id="city" placeholder="Enter city">
  <button onclick="search()">Search</button>
</div>

<div class="card center">
  <div class="icon" id="icon">â›…</div>
  <div class="temp" id="temp">--Â°C</div>
  <div id="desc">Loadingâ€¦</div>
  <div id="place"></div>
</div>

<div id="features"></div>

<div class="card">
  <h4>Hourly Temperature</h4>
  <canvas id="tChart"></canvas>
</div>

<div class="card">
  <h4>Hourly Rain</h4>
  <canvas id="rChart"></canvas>
</div>

<div class="card">
  <h4>Weekly Forecast</h4>
  <div class="week-scroll" id="week"></div>
</div>

<footer>Â© Climix 2025. All Rights Reserved.</footer>
</div>

<script>
let currentLat,currentLon;

/* ---------- INIT ---------- */
window.onload=()=>{
  loadWeather(28.6139,77.2090,"Delhi"); // always loads
};

/* ---------- SEARCH ---------- */
function search(){
 const c=document.getElementById("city").value;
 if(!c) return;
 fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(c)}`)
 .then(r=>r.json())
 .then(d=>{
   if(!d.results) return alert("City not found");
   const x=d.results[0];
   loadWeather(x.latitude,x.longitude,x.name);
 });
}

/* ---------- WEATHER ---------- */
function loadWeather(lat,lon,name){
 currentLat=lat;currentLon=lon;
 fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation_probability,humidity_2m&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`)
 .then(r=>r.json())
 .then(d=>{
   localStorage.weather=JSON.stringify(d);
   renderWeather(d,name);
   renderWeekly(d.daily);
   loadAQI(lat,lon);
 });
}

function renderWeather(d,name){
 const temp=typeof d.current_weather?.temperature==="number"
  ? d.current_weather.temperature
  : d.hourly.temperature_2m[0];

 const code=d.current_weather.weathercode;
 document.getElementById("temp").innerText=temp+"Â°C";
 document.getElementById("icon").innerText=iconOf(code);
 document.getElementById("desc").innerText=textOf(code);
 document.getElementById("place").innerText=name;

 drawChart(d.hourly.temperature_2m,"tChart");
 drawChart(d.hourly.precipitation_probability,"rChart");

 const f=[
  ["Latitude",currentLat.toFixed(2)],
  ["Longitude",currentLon.toFixed(2)],
  ["Humidity",d.hourly.humidity_2m[0]+"%"],
  ["Weather",textOf(code)]
 ];

 const container=document.getElementById("features");
 container.innerHTML="";
 const card=document.createElement("div");
 card.className="card grid";
 f.forEach(x=>{
  const b=document.createElement("div");
  b.className="box";
  b.innerHTML=`${x[0]}<br><b>${x[1]}</b>`;
  card.appendChild(b);
 });
 container.appendChild(card);
}

/* ---------- AQI (REAL) ---------- */
function loadAQI(lat,lon){
 fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10,us_aqi`)
 .then(r=>r.json())
 .then(a=>{
   const v=a.hourly.us_aqi[0];
   const card=document.createElement("div");
   card.className="card grid";
   card.innerHTML=`
    <div class="box">AQI<br><b>${v}</b></div>
    <div class="box">PM2.5<br><b>${a.hourly.pm2_5[0]}</b></div>
    <div class="box">PM10<br><b>${a.hourly.pm10[0]}</b></div>
    <div class="box">Health<br><b>${aqiAdvice(v)}</b></div>
   `;
   document.getElementById("features").appendChild(card);
 });
}

/* ---------- WEEKLY ---------- */
function renderWeekly(d){
 const w=document.getElementById("week");
 w.innerHTML="";
 d.time.forEach((t,i)=>{
  const c=document.createElement("div");
  c.className="week-card";
  c.innerHTML=`
   <div>${new Date(t).toLocaleDateString("en",{weekday:"short"})}</div>
   <div style="font-size:28px">${iconOf(d.weathercode[i])}</div>
   <div>${d.temperature_2m_max[i]}Â° / ${d.temperature_2m_min[i]}Â°</div>
  `;
  w.appendChild(c);
 });
}

/* ---------- CHART ---------- */
function drawChart(data,id){
 const c=document.getElementById(id);
 const x=c.getContext("2d");
 c.width=320;c.height=160;
 x.clearRect(0,0,320,160);
 const m=Math.min(...data),M=Math.max(...data);
 x.beginPath();
 data.slice(0,24).forEach((v,i)=>{
  const X=i*(320/23);
  const Y=160-((v-m)/(M-m||1))*160;
  i?x.lineTo(X,Y):x.moveTo(X,Y);
 });
 x.strokeStyle="#00e5ff";
 x.lineWidth=2;
 x.stroke();
}

/* ---------- HELPERS ---------- */
function iconOf(c){return c==0?"â˜€":c<4?"â›…":c<70?"ðŸŒ§":"ðŸŒ©";}
function textOf(c){return c==0?"Clear":c<4?"Cloudy":c<70?"Rain":"Storm";}
function aqiAdvice(v){
 if(v<=50) return "Good";
 if(v<=100) return "Moderate";
 if(v<=150) return "Unhealthy (Sensitive)";
 if(v<=200) return "Unhealthy";
 return "Hazardous";
}
</script>
</body>
</html>
