<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weathia</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system}
:root{--aqi-tint:rgba(0,0,0,0)}

body{
  background:#000;
  color:#fff;
  display:flex;
  justify-content:center;
}
body.oled{background:#000}

.app-frame{
  width:100%;
  max-width:420px;
  padding:16px;
  background:linear-gradient(180deg,var(--aqi-tint),#000);
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}

.toggle{
  width:38px;height:38px;border-radius:50%;
  border:none;background:#111;color:#fff;font-size:18px;
}

.card{
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:18px;
  margin-bottom:14px;
}

.card h2{
  font-size:1.25rem;
  margin-bottom:10px;
  border-bottom:1px solid rgba(255,255,255,.15);
  padding-bottom:6px;
}

.main-temp{font-size:3.4rem;font-weight:800;text-align:center}
.sub-temp{text-align:center;font-size:1.3rem}

input,button{
  height:46px;border-radius:14px;border:none;font-size:1rem;
}
input{width:70%;padding:0 10px}
button{width:28%;background:#222;color:#fff}

.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.row{
  display:flex;justify-content:space-between;
  padding:8px 10px;background:rgba(255,255,255,.08);
  border-radius:10px;margin-bottom:6px;
}

.hourly{display:flex;gap:10px;overflow-x:auto}
.hour{
  min-width:72px;text-align:center;
  background:rgba(255,255,255,.08);
  padding:10px;border-radius:12px;
}

.aqi-big{text-align:center;font-size:2.3rem;font-weight:800}
.small{text-align:center;font-size:.85rem;opacity:.75}
</style>
</head>

<body class="oled">
<div class="app-frame">

<header>
  <h1>Weathia</h1>
  <button class="toggle" onclick="toggleOLED()">ðŸ–¤</button>
</header>

<div class="card">
  <input id="city" placeholder="Enter city">
  <button onclick="loadWeather()">Search</button>
</div>

<div class="card">
  <div id="temp" class="main-temp">--Â°C</div>
  <div id="feel" class="sub-temp">Feels like --Â°C</div>
</div>

<div class="card">
<h2>Air Quality Index</h2>
<div id="aqiValue" class="aqi-big">AQI --</div>
<div id="aqiCategory" style="text-align:center"></div>
<div id="aqiHealth" class="small"></div>

<div class="grid-2" style="margin-top:10px">
  <div>PM2.5 <span id="pm25">--</span></div>
  <div>PM10 <span id="pm10">--</span></div>
  <div>NOâ‚‚ <span id="no2">--</span></div>
  <div>Oâ‚ƒ <span id="o3">--</span></div>
</div>
</div>

<div class="card">
<h2>Next 24 Hours</h2>
<div id="hourly" class="hourly"></div>
</div>

<div class="card">
<h2>7-Day Forecast</h2>
<div id="daily"></div>
</div>

<div class="card small">Â© Manik Roy 2025</div>
</div>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

function toggleOLED(){
  document.body.classList.toggle("oled");
}

function aqiFromPM25(pm){
  if(pm<=12) return [50,"Good","Air quality is ideal."];
  if(pm<=35) return [100,"Moderate","Sensitive people take care."];
  if(pm<=55) return [150,"Unhealthy","Reduce outdoor activity."];
  return [200,"Very Unhealthy","Avoid outdoor exposure."];
}

function applyAQITint(aqi){
  let t="rgba(0,0,0,0)";
  if(aqi<=50) t="rgba(0,120,255,.12)";
  else if(aqi<=100) t="rgba(255,200,0,.15)";
  else if(aqi<=150) t="rgba(255,120,0,.18)";
  else t="rgba(180,0,0,.22)";
  document.documentElement.style.setProperty("--aqi-tint",t);
}

async function fetchData(lat,lon){
  const r=await fetch(
`https://api.open-meteo.com/v1/forecast?
latitude=${lat}&longitude=${lon}
&current=temperature_2m,apparent_temperature
&hourly=temperature_2m,pm2_5,pm10,nitrogen_dioxide,ozone
&daily=temperature_2m_min,temperature_2m_max
&timezone=auto`.replace(/\s+/g,""));
  return r.json();
}

async function loadWeather(city){
  try{
    let lat,lon;
    if(!city){
      await new Promise((res,rej)=>{
        navigator.geolocation.getCurrentPosition(p=>{
          lat=p.coords.latitude;
          lon=p.coords.longitude;
          res();
        },rej);
      });
    }else{
      const g=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`);
      const j=await g.json();
      lat=j.results[0].latitude;
      lon=j.results[0].longitude;
    }

    const d=await fetchData(lat,lon);

    temp.textContent=Math.round(d.current.temperature_2m)+"Â°C";
    feel.textContent="Feels like "+Math.round(d.current.apparent_temperature)+"Â°C";

    pm25.textContent=d.hourly.pm2_5[0]+" Âµg";
    pm10.textContent=d.hourly.pm10[0]+" Âµg";
    no2.textContent=d.hourly.nitrogen_dioxide[0]+" Âµg";
    o3.textContent=d.hourly.ozone[0]+" Âµg";

    const [aqi,cat,health]=aqiFromPM25(d.hourly.pm2_5[0]);
    aqiValue.textContent="AQI "+aqi;
    aqiCategory.textContent=cat;
    aqiHealth.textContent=health;
    applyAQITint(aqi);

    hourly.innerHTML="";
    d.hourly.temperature_2m.slice(0,24).forEach((t,i)=>{
      const time=new Date(d.hourly.time[i]).toLocaleTimeString([], {hour:'2-digit'});
      hourly.innerHTML+=`<div class="hour">${time}<br><b>${t}Â°</b></div>`;
    });

    daily.innerHTML="";
    d.daily.time.forEach((dt,i)=>{
      daily.innerHTML+=`
      <div class="row">
        <span>${new Date(dt).toDateString().slice(0,10)}</span>
        <span>${d.daily.temperature_2m_min[i]}Â° / ${d.daily.temperature_2m_max[i]}Â°</span>
      </div>`;
    });

  }catch{
    alert("Location or network error");
  }
}

loadWeather();
</script>
</body>
</html>
