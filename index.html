<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Climix</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui}
body{background:#000;color:#fff;display:flex;justify-content:center}
.app-frame{width:100%;max-width:420px;padding:16px}

.card{
background:rgba(255,255,255,.07);
border-radius:18px;
padding:18px;
margin-bottom:14px
}

input,button{
height:46px;border-radius:14px;border:none;font-size:1rem
}
input{width:55%;padding:0 12px}
button{background:#222;color:#fff;padding:0 12px}

.main-temp{text-align:center;font-size:3.5rem;font-weight:800}
.sub{text-align:center;opacity:.8}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.row{display:flex;justify-content:space-between}
</style>
</head>

<body>
<div class="app-frame">

<h2>Climix</h2>

<div class="card">
<input id="city" placeholder="Enter city">
<button onclick="searchCity()">Search</button>
<button onclick="detectLocation()">üìç</button>
</div>

<div class="card">
<div id="temp" class="main-temp">--¬∞C</div>
<div id="status" class="sub">Waiting...</div>
</div>

<div class="card grid">
<div>Humidity <span id="hum">--</span></div>
<div>Wind <span id="wind">--</span></div>
<div>Pressure <span id="press">--</span></div>
<div>Visibility <span id="vis">--</span></div>
</div>

<div class="card">
<h3>Next Hours</h3>
<div id="hourly"></div>
</div>

<div class="card" style="text-align:center;font-size:.8rem">
¬© Manik Roy 2025
</div>

</div>

<script>
/* SAFE START */
window.onload=()=>{
  const lat=localStorage.getItem("lat")
  const lon=localStorage.getItem("lon")
  if(lat && lon) loadWeather(lat,lon)
}

/* LOCATION */
function detectLocation(){
  status.textContent="Requesting GPS..."
  navigator.geolocation.getCurrentPosition(
    p=>{
      save(p.coords.latitude,p.coords.longitude)
      loadWeather(p.coords.latitude,p.coords.longitude)
    },
    ()=>{
      status.textContent="Permission denied"
    },
    {timeout:8000}
  )
}

/* SEARCH */
async function searchCity(){
  if(!city.value) return
  status.textContent="Searching..."
  const r=await fetch(
    `https://geocoding-api.open-meteo.com/v1/search?name=${city.value}&count=1`
  )
  const j=await r.json()
  if(!j.results) return status.textContent="City not found"
  save(j.results[0].latitude,j.results[0].longitude)
  loadWeather(j.results[0].latitude,j.results[0].longitude)
}

/* WEATHER */
async function loadWeather(lat,lon){
  status.textContent="Loading..."
  try{
    const w=await fetch(
    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,pressure_msl,visibility&hourly=temperature_2m,time&timezone=auto`
    ).then(r=>r.json())

    temp.textContent=Math.round(w.current.temperature_2m)+"¬∞C"
    hum.textContent=w.current.relative_humidity_2m+"%"
    wind.textContent=w.current.wind_speed_10m
    press.textContent=w.current.pressure_msl
    vis.textContent=(w.current.visibility/1000).toFixed(1)+" km"

    hourly.innerHTML=w.hourly.time.slice(0,6).map((t,i)=>`
      <div class="row">
      <span>${new Date(t).toLocaleTimeString([], {hour:'2-digit'})}</span>
      <span>${Math.round(w.hourly.temperature_2m[i])}¬∞</span>
      </div>
    `).join("")

    status.textContent="Updated"

  }catch{
    status.textContent="Network error"
  }
}

/* SAVE */
function save(lat,lon){
  localStorage.setItem("lat",lat)
  localStorage.setItem("lon",lon)
}
</script>

</body>
</html>
