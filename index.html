<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Climix - Premium Weather PWA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2196f3">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
 font-family:'Segoe UI',sans-serif;
 overflow-y:auto;
 display:flex;
 justify-content:center;
 min-height:100vh;
 transition:background 2s;
 background:linear-gradient(160deg,#f6d365,#fda085);
 color:#fff;
}
.app{
 width:100%;
 max-width:420px;
 padding:16px;
 max-height:95vh;
 border-radius:30px;
 overflow-y:auto;
 backdrop-filter:blur(16px);
 background:rgba(255,255,255,0.15);
 border:1px solid rgba(255,255,255,0.3);
 box-shadow:0 20px 40px rgba(0,0,0,.25);
 position:relative;
 animation:fadeIn 1.2s ease-out;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.app::-webkit-scrollbar{display:none;}
.toggle{
 position:absolute;
 top:16px;
 right:16px;
 width:50px;
 height:50px;
 border-radius:50%;
 border:none;
 background:rgba(0,0,0,0.35);
 color:#fff;
 font-size:20px;
 z-index:20;
 cursor:pointer;
 transition:0.3s;
}
.toggle:hover{background:rgba(0,0,0,0.55);}
.card{
 margin-bottom:14px;
 padding:18px;
 border-radius:24px;
 background:rgba(255,255,255,0.15);
 backdrop-filter:blur(14px);
 transition:0.5s;
 box-shadow:0 8px 16px rgba(0,0,0,.2);
 position:relative;
}
.dark .app{background:rgba(30,30,30,0.45);}
.dark .card{background:rgba(50,50,50,0.25);color:#fff;}
.dark body{background:linear-gradient(160deg,#0f2027,#203a43,#2c5364);}
.center{text-align:center;}
input,button{width:100%;padding:12px;border-radius:14px;border:none;font-size:16px;}
button{background:#2196f3;color:#fff;margin-top:6px;cursor:pointer;transition:0.3s;box-shadow:0 4px 10px rgba(0,0,0,.2);}
button:hover{background:#1976d2;}
.icon{font-size:70px;transition:0.5s;text-shadow:0 0 8px rgba(255,255,255,0.7);}
.temp{font-size:52px;font-weight:bold;text-shadow:0 0 12px #fff;}
.desc{font-size:18px;opacity:.9;text-shadow:0 0 6px #fff;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.box{
 padding:12px;
 border-radius:18px;
 background:rgba(0,0,0,0.1);
 text-align:center;
 transition:0.4s;
 box-shadow:0 4px 8px rgba(0,0,0,.15);
}
canvas{width:100%;height:160px;border-radius:14px;}
.chart-tooltip{
 position:absolute;
 background:rgba(0,0,0,0.7);
 padding:6px 10px;
 border-radius:8px;
 pointer-events:none;
 font-size:14px;
 opacity:0;
 transition:0.2s;
 color:#fff;
 z-index:10;
}
footer{text-align:center;font-size:12px;opacity:.7;margin-top:10px;}
.week-card{display:flex;flex-direction:column;align-items:center;padding:12px;background:rgba(255,255,255,0.15);border-radius:20px;box-shadow:0 4px 12px rgba(0,0,0,.15);}
.week-card .icon{font-size:36px;text-shadow:0 0 6px #fff;}
.week-scroll{display:flex;overflow-x:auto;gap:12px;padding-top:8px;}
.week-scroll::-webkit-scrollbar{display:none;}
.glow{animation:glowPulse 2s infinite;}
@keyframes glowPulse{
 0%,100%{box-shadow:0 0 12px rgba(255,255,255,0.6);}
 50%{box-shadow:0 0 24px rgba(255,255,255,0.9);}
}
</style>
</head>

<body>
<div class="app" id="app">
<button class="toggle" onclick="toggleDark()">üåô</button>

<!-- App Title -->
<div class="card center glow">
 <h2>Climix</h2>
</div>

<!-- Search -->
<div class="card">
 <input id="city" placeholder="Enter city">
 <button onclick="search()">Search</button>
</div>

<!-- Home-Screen Interactive Widget -->
<div class="card glow center" id="widgetCard">
  <div style="display:flex;justify-content:space-around;align-items:center;flex-wrap:wrap;">
    <div id="tempWidget" style="flex:1;min-width:120px;">
      <div class="icon" id="tempIcon">‚õÖ</div>
      <div id="tempVal" style="font-size:28px;font-weight:bold;">--¬∞C</div>
      <canvas id="tMiniChart" style="height:50px;margin-top:6px;"></canvas>
    </div>
    <div id="aqiWidget" style="flex:1;min-width:120px;">
      <div style="font-size:16px;">AQI</div>
      <div id="aqiVal" style="font-size:28px;font-weight:bold;">--</div>
      <div id="aqiAdvice" style="font-size:12px;opacity:0.8;">--</div>
      <canvas id="rMiniChart" style="height:50px;margin-top:6px;"></canvas>
    </div>
  </div>
</div>

<!-- Current Weather -->
<div class="card center glow" id="weatherCard">
 <div class="icon" id="icon">‚õÖ</div>
 <div class="temp" id="temp">--¬∞C</div>
 <div class="desc" id="desc">Loading...</div>
 <div id="place" class="desc">Fetching location‚Ä¶</div>
</div>

<!-- Unified Location + AQI Card -->
<div class="card grid" id="unifiedCard"></div>

<!-- Sunrise/Sunset/Moon -->
<div class="card grid">
 <div class="box">üåÖ Sunrise<br><b id="sunrise">--:--</b></div>
 <div class="box">üåá Sunset<br><b id="sunset">--:--</b></div>
 <div class="box">üåô Moon<br><b id="moon">--</b></div>
 <div class="box">üìç City<br><b id="cityName">--</b></div>
</div>

<!-- Hourly Charts -->
<div class="card">
 <h4>üìà Hourly Temperature</h4>
 <canvas id="tChart"></canvas>
 <div class="chart-tooltip" id="tTooltip"></div>
</div>
<div class="card">
 <h4>‚òî Hourly Rain %</h4>
 <canvas id="rChart"></canvas>
 <div class="chart-tooltip" id="rTooltip"></div>
</div>
<div class="card">
 <h4>üí® Hourly Wind</h4>
 <canvas id="wChart"></canvas>
 <div class="chart-tooltip" id="wTooltip"></div>
</div>

<!-- Weekly Forecast -->
<div class="card">
 <h4>üìÖ Weekly Forecast</h4>
 <div class="week-scroll" id="week"></div>
</div>

<footer>¬© Climix 2025. All Rights Reserved.</footer>
</div>

<script>
// Dark mode
function toggleDark(){document.body.classList.toggle("dark");}

// Background animation
function setBackground(code){
 let bg="linear-gradient(160deg,#f6d365,#fda085)";
 if(code==0) bg="linear-gradient(160deg,#f6d365,#fda085)";
 else if(code<4) bg="linear-gradient(160deg,#a1c4fd,#c2e9fb)";
 else if(code<70) bg="linear-gradient(160deg,#4facfe,#00f2fe)";
 else bg="linear-gradient(160deg,#667db6,#0082c8)";
 document.body.style.background=bg;
}

// Notifications
if("Notification" in window) Notification.requestPermission();

// Variables for location
let currentLat,currentLon;

// Geolocation
navigator.geolocation?.getCurrentPosition(
 p=>{currentLat=p.coords.latitude; currentLon=p.coords.longitude; loadWeather(currentLat,currentLon,"Your Location");},
 ()=>document.getElementById("place").innerText="Enter a city to search"
);

// Search
function search(){
 const cityName=document.getElementById("city").value;
 if(!cityName) return;
 fetch("https://geocoding-api.open-meteo.com/v1/search?name="+encodeURIComponent(cityName))
 .then(r=>r.json()).then(d=>{
  if(!d.results) return alert("City not found");
  const x=d.results[0];
  currentLat=x.latitude; currentLon=x.longitude;
  loadWeather(x.latitude,x.longitude,x.name);
 });
}

// Load Weather
function loadWeather(lat,lon,name){
 fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation_probability,wind_speed_10m,humidity_2m,surface_pressure,cloudcover,uv_index,visibility&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset,weathercode,moon_phase&timezone=auto`)
 .then(r=>r.json()).then(d=>{
  localStorage.weather=JSON.stringify(d);
  renderWeather(d,name,lat,lon);
 });
}

// Render Weather
function renderWeather(d,name,lat,lon){
 document.getElementById("place").innerText=name;
 document.getElementById("cityName").innerText=name;

 const temp = d.current_weather?.temperature ?? d.hourly?.temperature_2m?.[0] ?? "--";
 const code = d.current_weather?.weathercode ?? d.daily?.weathercode?.[0] ?? 0;
 document.getElementById("temp").innerText = temp + "¬∞C";
 document.getElementById("icon").innerText = iconOf(code);
 document.getElementById("desc").innerText = textOf(code);
 setBackground(code);

 // Unified Card
 const unified=document.getElementById("unifiedCard");
 unified.innerHTML="";
 const locFeatures=[
 ["Latitude",lat.toFixed(2]],
 ["Longitude",lon.toFixed(2]],
 ["Temp",temp+"¬∞C"],
 ["Weather",textOf(code)],
 ["Humidity",d.hourly?.humidity_2m?.[0]??"--"],
 ["Wind",d.current_weather?.wind_speed??"--"],
 ["Pressure",d.hourly?.surface_pressure?.[0]??"--"],
 ["Cloud",d.hourly?.cloudcover?.[0]??"--"],
 ["UV",d.hourly?.uv_index?.[0]??"--"],
 ["Visibility",d.hourly?.visibility?.[0]??"--"]
 ];
 locFeatures.forEach(f=>{let b=document.createElement("div");b.className="box glow";b.innerHTML=`${f[0]}<br><b>${f[1]}</b>`;unified.appendChild(b);});

 // Update Home-Screen Widget
 const aqiVal = 70; // Example AQI
 let aqiAdvice = "Good";
 if(aqiVal>50 && aqiVal<=100) aqiAdvice="Moderate";
 else if(aqiVal>100) aqiAdvice="Poor";
 updateWidgets(temp, code, aqiVal, aqiAdvice);

 // Draw Hourly Charts
 drawChart(d.hourly?.temperature_2m,document.getElementById("tChart"),document.getElementById("tTooltip"),'¬∞C');
 drawChart(d.hourly?.precipitation_probability,document.getElementById("rChart"),document.getElementById("rTooltip"),'%');
 drawChart(d.hourly?.wind_speed_10m,document.getElementById("wChart"),document.getElementById("wTooltip"),'m/s');

 // Draw Mini Charts
 drawMiniChart(d.hourly?.temperature_2m, document.getElementById("tMiniChart"), "#ffeb3b");
 drawMiniChart(d.hourly?.precipitation_probability, document.getElementById("rMiniChart"), "#00f2fe",100);

 // Alerts
 checkAlerts(aqiVal, d.hourly?.precipitation_probability?.[0]??0, temp);
}

// Widgets
function updateWidgets(temp, code, aqi, advice){
 document.getElementById("tempVal").innerText = temp+"¬∞C";
 document.getElementById("tempIcon").innerText = iconOf(code);
 document.getElementById("aqiVal").innerText = aqi;
 document.getElementById("aqiAdvice").innerText = advice;
}

// Charts
function drawChart(data,canvas,tooltip,suffix){
 if(!data || !canvas) return;
 const ctx=canvas.getContext("2d");
 canvas.width=320;canvas.height=160;
 ctx.clearRect(0,0,320,160);
 const arr=data.slice(0,24);
 const min=Math.min(...arr);
 const max=Math.max(...arr);
 ctx.beginPath();
 arr.forEach((v,i)=>{
  const x=i*(320/23);
  const y=160-((v-min)/(max-min||1))*160;
  i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.strokeStyle="#00f2fe";
 ctx.lineWidth=2;
 ctx.stroke();
 canvas.onmousemove=function(e){
  const rect=canvas.getBoundingClientRect();
  const mx=e.clientX-rect.left;
  const idx=Math.round(mx/(320/23));
  if(idx>=0 && idx<arr.length){
   tooltip.style.opacity=1;
   tooltip.style.left=(mx+10)+"px";
   tooltip.style.top=(e.clientY-rect.top-30)+"px";
   tooltip.innerText=arr[idx]+suffix;
  }
 };
 canvas.onmouseleave=function(){tooltip.style.opacity=0;}
}

// Mini Charts
function drawMiniChart(data, canvas, color="#fff", maxVal){
 if(!data || !canvas) return;
 const ctx = canvas.getContext("2d");
 canvas.width = canvas.offsetWidth;
 canvas.height = canvas.offsetHeight;
 const arr = data.slice(0,12);
 const min = Math.min(...arr);
 const max = maxVal || Math.max(...arr);
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.beginPath();
 arr.forEach((v,i)=>{
   const x = i*(canvas.width/(arr.length-1));
   const y = canvas.height - ((v-min)/(max-min||1))*canvas.height;
   i?ctx.lineTo(x,y):ctx.moveTo(x,y);
 });
 ctx.strokeStyle = color;
 ctx.lineWidth = 2;
 ctx.stroke();
}

// Alerts
function notify(title,msg){
 if(Notification.permission==='granted'){
   navigator.serviceWorker.getRegistration().then(reg=>{
     reg.showNotification(title,{body:msg,icon:'icon.png'});
   });
 }
}
function checkAlerts(aqi,rain,temp){
 if(aqi>100) notify("AQI Alert","Air quality is unhealthy. Limit outdoor activity!");
 if(rain>50) notify("Rain Alert","High chance of rain. Carry an umbrella!");
 if(aqi>200 && temp>40) notify("Heatwave Alert","Dangerous heat and poor air quality!");
}

// Utilities
function iconOf(c){return c==0?"‚òÄ":c<4?"‚õÖ":c<70?"üåß":"üå©";}
function textOf(c){return c==0?"Clear":c<4?"Cloudy":c<70?"Rain":"Storm";}

// Register service worker
if('serviceWorker' in navigator){
 navigator.serviceWorker.register('sw.js').then(()=>console.log('SW Registered'));
}

// Auto refresh every 15 minutes
setInterval(()=>{if(currentLat&&currentLon) loadWeather(currentLat,currentLon,"Your Location");},900000);
</script>
</body>
</html>
