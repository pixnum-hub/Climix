<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Climix</title>
<link rel="manifest" href="manifest.json">
<style>
*{box-sizing:border-box;}
body{margin:0;font-family:system-ui;display:flex;justify-content:center;background:#000;color:#fff;}
.app{width:100%;max-width:420px;padding:16px;display:flex;flex-direction:column;align-items:center;position:relative;}
.card{width:100%;background:rgba(255,255,255,0.08);backdrop-filter:blur(18px);border-radius:22px;padding:18px;margin-bottom:16px;text-align:center;}
input,button{width:100%;padding:16px;font-size:1.25rem;border-radius:16px;border:none;}
button{cursor:pointer;margin-top:6px;}
.temp{font-size:4.8rem;font-weight:800;text-align:center;}
.place{font-size:1.6rem;opacity:.9;text-align:center;}
h3{font-size:1.5rem;margin:0 0 12px;text-align:center;}
.item{width:100%;background:rgba(0,0,0,.35);padding:12px;border-radius:14px;margin-bottom:10px;font-size:1.2rem;text-align:center;}
.toggle{position:absolute;top:16px;right:16px;width:44px;height:44px;border-radius:50%;border:none;font-size:20px;background:#111;color:#fff;}
.footer{text-align:center;opacity:.7;}
.alert{background:#ff4444;color:#fff;font-weight:bold;padding:12px;border-radius:12px;margin-bottom:10px;}
.hour-block{margin-bottom:12px;}
</style>
</head>
<body>
<div class="app">

<button class="toggle" onclick="toggleMode()">ğŸŒ™</button>

<div class="card">
  <input id="city" placeholder="Enter city">
  <button onclick="search()">Search</button>
</div>

<div class="card">
  <div class="temp" id="temp">--Â°C</div>
  <div class="place" id="place">Loadingâ€¦</div>
</div>

<div class="card" id="alerts"></div>

<div class="card">
  <h3>ğŸ“ Location Conditions</h3>
  <div id="conditions"></div>
</div>

<div class="card">
  <h3>â±ï¸ Hourly (Next 24h)</h3>
  <div id="hourly"></div>
</div>

<div class="card">
  <h3>ğŸ“† 7-Day Forecast</h3>
  <div id="daily"></div>
</div>

<div class="card">
  <h3>ğŸŒ… Sun & Moon</h3>
  <div id="sunmoon"></div>
</div>

<div class="card">
  <h3>ğŸŒ«ï¸ AQI Details</h3>
  <div id="aqi"></div>
</div>

<div class="card footer">
  Â© Manik Roy 2025. All Rights Reserved.
</div>

</div>

<script>
let dark=false;
function toggleMode(){
  dark=!dark;
  document.body.style.background = dark?"#000":"#050505";
}

/* ===== FETCH JSON ===== */
async function getJSON(url){
  try{const r=await fetch(url);if(!r.ok)throw 0;return await r.json();}
  catch{return null;}
}

async function search(){
  const name=document.getElementById("city").value.trim();
  if(!name)return;
  const geo=await getJSON("https://geocoding-api.open-meteo.com/v1/search?name="+encodeURIComponent(name)+"&count=1");
  if(!geo||!geo.results)return;
  const g=geo.results[0];
  load(g.latitude,g.longitude,g.name);
}

async function load(lat,lon,name){
  document.getElementById("place").textContent=name;

  const w=await getJSON(
    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,precipitation,windspeed_10m,relative_humidity_2m,cloudcover,uv_index,visibility,dewpoint_2m&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset&timezone=auto`
  );
  if(!w)return;

  document.getElementById("temp").textContent=w.current_weather.temperature+"Â°C";

  /* ===== ALERTS ===== */
  const alerts=document.getElementById("alerts");
  alerts.innerHTML="";
  if(w.current_weather.temperature>=40)alerts.innerHTML+='<div class="alert">âš ï¸ Heatwave Alert!</div>';
  if(w.hourly.precipitation[0]>=20)alerts.innerHTML+='<div class="alert">âš ï¸ Heavy Rain Alert!</div>';

  /* ===== LOCATION CONDITIONS (10) ===== */
  const c=w.hourly;
  document.getElementById("conditions").innerHTML=`
    <div class="item">Temperature: ${w.current_weather.temperature}Â°C</div>
    <div class="item">Humidity: ${c.relative_humidity_2m[0]}%</div>
    <div class="item">Wind: ${w.current_weather.windspeed} km/h</div>
    <div class="item">Precipitation: ${c.precipitation[0]} mm</div>
    <div class="item">Pressure: ${c.pressure_msl?c.pressure_msl[0]:'N/A'} hPa</div>
    <div class="item">Cloud Cover: ${c.cloudcover?c.cloudcover[0]:'N/A'}%</div>
    <div class="item">UV Index: ${c.uv_index?c.uv_index[0]:'N/A'}</div>
    <div class="item">Visibility: ${c.visibility?c.visibility[0]:'N/A'} km</div>
    <div class="item">Dew Point: ${c.dewpoint_2m?c.dewpoint_2m[0]:'N/A'}Â°C</div>
    <div class="item">Timezone: ${w.timezone}</div>
  `;

  /* ===== HOURLY 24H (split 4 blocks of 6h) ===== */
  const hourlyEl=document.getElementById("hourly"); hourlyEl.innerHTML="";
  for(let b=0;b<4;b++){
    const block=document.createElement("div"); block.className="hour-block";
    for(let i=b*6;i<(b+1)*6;i++){
      block.innerHTML+=`<div class="item">Hour ${i+1}: ${c.temperature_2m[i]}Â°C | Wind ${c.windspeed_10m[i]} km/h | Rain ${c.precipitation[i]} mm</div>`;
    }
    hourlyEl.appendChild(block);
  }

  /* ===== 7-DAY FORECAST with dates ===== */
  const dailyEl=document.getElementById("daily"); dailyEl.innerHTML="";
  const today=new Date();
  for(let i=0;i<7;i++){
    const d=new Date(today); d.setDate(today.getDate()+i);
    const dateStr=d.toLocaleDateString(undefined,{day:'2-digit',month:'short',year:'numeric'});
    dailyEl.innerHTML+=`<div class="item">${dateStr}: Min ${w.daily.temperature_2m_min[i]}Â°C / Max ${w.daily.temperature_2m_max[i]}Â°C</div>`;
  }

  /* ===== SUN & MOON ===== */
  document.getElementById("sunmoon").innerHTML=`
    Sunrise: ${w.daily.sunrise[0]}<br>
    Sunset: ${w.daily.sunset[0]}<br>
    Moon Phase: ${getMoonPhase(new Date())}
  `;

  /* ===== AQI ===== */
  const aq=await getJSON(
    `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=us_aqi,pm2_5,pm10,ozone,carbon_monoxide,nitrogen_dioxide,sulphur_dioxide,nh3,voc`
  );
  if(aq){
    const v=aq.hourly;
    const health= v.us_aqi[0]>=150 ? "Unhealthy" : v.us_aqi[0]>=100 ? "Moderate" : "Good";
    document.getElementById("aqi").innerHTML=`
      <div class="item">AQI: ${v.us_aqi[0]} (${health})</div>
      <div class="item">PM2.5: ${v.pm2_5[0]} Âµg/mÂ³</div>
      <div class="item">PM10: ${v.pm10[0]} Âµg/mÂ³</div>
      <div class="item">Ozone: ${v.ozone[0]} Âµg/mÂ³</div>
      <div class="item">CO: ${v.carbon_monoxide[0]} Âµg/mÂ³</div>
      <div class="item">NOâ‚‚: ${v.nitrogen_dioxide[0]} Âµg/mÂ³</div>
      <div class="item">SOâ‚‚: ${v.sulphur_dioxide[0]} Âµg/mÂ³</div>
      <div class="item">NHâ‚ƒ: ${v.nh3[0]} Âµg/mÂ³</div>
      <div class="item">VOC: ${v.voc[0]} Âµg/mÂ³</div>
    `;
  }

  /* ===== Adaptive Background based on AQI ===== */
  if(aq && v.us_aqi[0]>=100) document.body.style.background="#220000";
  else if(aq && v.us_aqi[0]>=50) document.body.style.background="#222200";
  else document.body.style.background=dark?"#000":"#050505";
}

/* ===== MOON PHASE ===== */
function getMoonPhase(date){
  const lp = 2551443; const new_moon = new Date(1970,0,7,20,35,0).getTime()/1000;
  const phase = ((date.getTime()/1000 - new_moon) % lp)/lp;
  if(phase<0.02) return "New Moon";
  if(phase<0.25) return "First Quarter";
  if(phase<0.52) return "Full Moon";
  if(phase<0.75) return "Last Quarter";
  return "Waning Crescent";
}

/* ===== INITIAL LOAD ===== */
load(28.61,77.20,"Delhi");

/* ===== PWA SW ===== */
if('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('./sw.js')
      .then(reg=>console.log("SW registered",reg))
      .catch(err=>console.log("SW failed",err));
  });
}
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();
  window.deferredPrompt=e;
});
</script>
</body>
</html>
