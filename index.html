<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Weathia</title>

<meta name="theme-color" content="#000000">
<link rel="manifest" href="manifest.json">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system}
body{
  background:#000;
  color:#fff;
  display:flex;
  justify-content:center;
}

:root{
  --aqi-tint:rgba(0,0,0,0);
}

.app{
  width:100%;
  max-width:420px;
  padding:16px;
  background:#000;
}

.app.aqi{
  box-shadow:inset 0 0 60px var(--aqi-tint);
}

.card{
  background:#000;
  border:1px solid rgba(255,255,255,0.08);
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
}

h1,h2{font-weight:700}
h2{font-size:1.15rem;margin-bottom:8px}

.big{font-size:2.6rem;text-align:center;font-weight:800}
.sub{text-align:center;opacity:.85}

.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
  font-size:.95rem;
}

.grid div{display:flex;justify-content:space-between}

input,button{
  height:46px;
  border-radius:14px;
  border:none;
  background:#111;
  color:#fff;
  font-size:1rem;
}

input{width:70%;padding:0 12px}
button{width:28%}

.hourly{
  display:flex;
  gap:10px;
  overflow-x:auto;
}

.hour{
  min-width:80px;
  border-radius:14px;
  padding:10px;
  background:#050505;
  text-align:center;
  font-size:.85rem;
}

.list .row{
  display:flex;
  justify-content:space-between;
  padding:8px 10px;
  border-bottom:1px solid rgba(255,255,255,.06);
}

.alert{
  padding:12px;
  border-radius:14px;
  background:#050505;
  font-size:.95rem;
}
</style>
</head>

<body>
<div class="app">

<header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
  <h1>Weathia</h1>
</header>

<div class="card">
  <input id="city" placeholder="Enter city">
  <button onclick="loadWeather(city.value)">Search</button>
</div>

<div class="card">
  <div id="cityName" class="sub">Kolkata, India</div>
  <div id="temp" class="big">--°C</div>
  <div id="feel" class="sub">Feels like --°C</div>
</div>

<div class="card">
<h2>Location Conditions</h2>
<div class="grid">
  <div>Humidity <span id="humidity">--</span></div>
  <div>Pressure <span id="pressure">--</span></div>
  <div>Wind <span id="wind">--</span></div>
  <div>Direction <span id="windDir">--</span></div>
  <div>Precip <span id="precip">--</span></div>
  <div>Cloud <span id="cloud">--</span></div>
  <div>Visibility <span id="vis">--</span></div>
  <div>UV <span id="uv">--</span></div>
  <div>Dew <span id="dew">--</span></div>
  <div>Sunrise <span id="sunrise">--</span></div>
  <div>Sunset <span id="sunset">--</span></div>
</div>
</div>

<div class="card">
<h2>Air Quality</h2>
<div id="aqiValue" class="big">--</div>
<div id="aqiCategory" class="sub"></div>
<div id="aqiHealth" class="sub"></div>

<div class="grid" style="margin-top:10px">
  <div>PM2.5 <span id="pm25">--</span></div>
  <div>PM10 <span id="pm10">--</span></div>
  <div>O₃ <span id="o3">--</span></div>
  <div>NO₂ <span id="no2">--</span></div>
</div>
</div>

<div class="card">
<h2>Pollutants (Now)</h2>
<canvas id="pollChart" height="160"></canvas>
</div>

<div class="card">
<h2>Next 24 Hours</h2>
<div id="hourly" class="hourly"></div>
</div>

<div class="card">
<h2>7-Day Forecast</h2>
<div id="daily" class="list"></div>
</div>

<div class="card">
<h2>Health Advisory</h2>
<div id="healthAlert" class="alert"></div>
</div>

<div class="card" style="text-align:center;font-size:.85rem;opacity:.6">
© Manik Roy 2025
</div>

</div>

<script>
let pollChart;

const DEFAULT_CITY="Kolkata";

function nowIndex(times){
  const now=new Date();
  return times.findIndex(t=>new Date(t)>now)-1;
}

function aqiFromPM25(pm){
  if(pm<=12) return 50;
  if(pm<=35) return 100;
  if(pm<=55) return 150;
  if(pm<=150) return 200;
  return 300;
}

function aqiTint(aqi){
  let t="rgba(0,0,0,0)";
  if(aqi<=50) t="rgba(0,120,255,.10)";
  else if(aqi<=100) t="rgba(0,180,120,.12)";
  else if(aqi<=150) t="rgba(255,160,0,.14)";
  else t="rgba(255,60,60,.18)";
  document.documentElement.style.setProperty("--aqi-tint",t);
  document.querySelector(".app").classList.add("aqi");
}

async function loadWeather(city){
  const geo=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city||DEFAULT_CITY}&count=1`).then(r=>r.json());
  const loc=geo.results[0];
  cityName.textContent=`${loc.name}, ${loc.country}`;

  const w=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.latitude}&longitude=${loc.longitude}&hourly=temperature_2m,apparent_temperature,relative_humidity_2m,pressure_msl,cloudcover,precipitation,uv_index,dew_point_2m,visibility,windspeed_10m,winddirection_10m&daily=temperature_2m_min,temperature_2m_max,sunrise,sunset,time&timezone=auto`).then(r=>r.json());

  const i=nowIndex(w.hourly.time);

  temp.textContent=Math.round(w.hourly.temperature_2m[i])+"°C";
  feel.textContent="Feels like "+Math.round(w.hourly.apparent_temperature[i])+"°C";

  humidity.textContent=w.hourly.relative_humidity_2m[i]+"%";
  pressure.textContent=w.hourly.pressure_msl[i]+" hPa";
  wind.textContent=w.hourly.windspeed_10m[i]+" km/h";
  windDir.textContent=w.hourly.winddirection_10m[i]+"°";
  precip.textContent=w.hourly.precipitation[i]+" mm";
  cloud.textContent=w.hourly.cloudcover[i]+"%";
  vis.textContent=(w.hourly.visibility[i]/1000).toFixed(1)+" km";
  uv.textContent=w.hourly.uv_index[i];
  dew.textContent=w.hourly.dew_point_2m[i]+"°C";

  sunrise.textContent=new Date(w.daily.sunrise[0]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  sunset.textContent=new Date(w.daily.sunset[0]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

  const air=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${loc.latitude}&longitude=${loc.longitude}&hourly=pm2_5,pm10,ozone,nitrogen_dioxide&timezone=auto`).then(r=>r.json());

  const pm25v=air.hourly.pm2_5[i];
  pm25.textContent=pm25v.toFixed(1);
  pm10.textContent=air.hourly.pm10[i].toFixed(1);
  o3.textContent=air.hourly.ozone[i].toFixed(1);
  no2.textContent=air.hourly.nitrogen_dioxide[i].toFixed(1);

  const AQI=aqiFromPM25(pm25v);
  aqiValue.textContent="AQI "+AQI;
  aqiCategory.textContent=AQI<=50?"Good":AQI<=100?"Moderate":AQI<=150?"Unhealthy (Sensitive)":"Unhealthy";
  aqiHealth.textContent=AQI<=100?"Normal activity":"Limit outdoor exposure";

  aqiTint(AQI);

  if(pollChart) pollChart.destroy();
  pollChart=new Chart(pollChart=document.getElementById("pollChart"),{
    type:"bar",
    data:{
      labels:["PM2.5","PM10","O₃","NO₂"],
      datasets:[{data:[pm25v,air.hourly.pm10[i],air.hourly.ozone[i],air.hourly.nitrogen_dioxide[i]]}]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{x:{ticks:{color:"#aaa"}},y:{ticks:{color:"#aaa"}}}
    }
  });

  hourly.innerHTML="";
  for(let h=0;h<24;h++){
    const t=new Date(w.hourly.time[i+h]).toLocaleTimeString([], {hour:'2-digit'});
    hourly.innerHTML+=`<div class="hour">${t}<br>${Math.round(w.hourly.temperature_2m[i+h])}°</div>`;
  }

  daily.innerHTML="";
  w.daily.time.forEach((d,x)=>{
    daily.innerHTML+=`<div class="row"><span>${d}</span><span>${w.daily.temperature_2m_min[x]}° / ${w.daily.temperature_2m_max[x]}°</span></div>`;
  });
}

loadWeather(DEFAULT_CITY);
</script>
</body>
</html>
