<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Climix</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#000">
<link rel="manifest" href="manifest.json">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
 min-height:100vh;
 display:flex;
 justify-content:center;
 font-family:system-ui,-apple-system,Segoe UI;
 background:linear-gradient(145deg,#050b18,#081a2e,#0a2236);
 color:#eaf1ff;
 overflow-y:auto;
 -webkit-overflow-scrolling:touch;
}
body.dark{background:#000}
.app{
 width:100%;
 max-width:420px;
 padding:14px;
 margin:14px;
 border-radius:28px;
 background:rgba(10,16,30,.85);
 backdrop-filter:blur(28px);
 box-shadow:0 30px 80px rgba(0,0,0,.85);
}
body.dark .app{background:#000}
.card{
 background:rgba(25,35,55,.55);
 border-radius:20px;
 padding:14px;
 margin-bottom:12px;
}
body.dark .card{background:rgba(20,20,20,.9)}
.center{text-align:center}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.box{
 background:rgba(0,0,0,.35);
 padding:10px;
 border-radius:14px;
 font-size:13px;
 text-align:center;
}
input,button{
 width:100%;
 padding:12px;
 border:none;
 border-radius:14px;
 font-size:15px;
}
input{background:rgba(255,255,255,.12);color:#fff}
button{
 background:#1f6feb;
 color:#fff;
 font-weight:600;
 margin-top:8px;
}
body.dark button{background:#222}
.temp{font-size:46px;font-weight:700}
.hourly{max-height:240px;overflow-y:auto}
.hour{
 display:flex;
 justify-content:space-between;
 padding:8px 12px;
 margin-bottom:6px;
 border-radius:12px;
 background:rgba(0,0,0,.25);
 font-size:14px;
}
footer{text-align:center;font-size:12px;opacity:.6;margin-top:10px}
.topbar{display:flex;justify-content:space-between;margin-bottom:8px;gap:8px}
.topbar button{width:44px;height:44px;border-radius:50%;padding:0;font-size:18px}
</style>
</head>

<body>
<div class="app">

<div class="topbar">
<button id="modeBtn">ğŸŒ™</button>
<button id="installBtn" style="display:none">â¬‡ï¸</button>
</div>

<div class="card center"><h2>Climix</h2></div>

<div class="card">
<input id="city" placeholder="Enter city">
<button onclick="search()">Search</button>
</div>

<div class="card center">
<div class="temp" id="temp">--Â°C</div>
<div id="place">Ready</div>
</div>

<div class="card center">
<h4>âš ï¸ Weather Alerts</h4>
<div id="alertsText">â€”</div>
</div>

<div class="card">
<h4>ğŸŒ§ï¸ Rain & Precipitation</h4>
<div class="grid" id="rainBox"></div>
</div>

<div class="card">
<h4>ğŸ“ Location Conditions</h4>
<div class="grid" id="locationBox"></div>
</div>

<div class="card">
<h4>ğŸŒ… Sun & ğŸŒ™ Moon</h4>
<div class="grid" id="astroBox"></div>
</div>

<div class="card">
<h4>ğŸŒ«ï¸ Air Quality (AQI)</h4>
<div class="grid" id="aqiBox"></div>
</div>

<div class="card">
<h4>ğŸŒ¡ï¸ Hourly Temperature (24h)</h4>
<div class="hourly" id="hourly"></div>
</div>

<div class="card center">
<h4>ğŸ•’ 24-Hour Summary</h4>
<div class="grid" id="summary"></div>
</div>

<footer>Â© Manik Roy 2025. All Rights Reserved.</footer>
</div>

<script>
/* ALL ORIGINS PROXY */
const proxy = "https://api.allorigins.win/raw?url=";

/* SAFE FETCH WITH PROXY */
async function safeFetch(url){
 try{
  const fullUrl = proxy + encodeURIComponent(url);
  const r = await fetch(fullUrl);
  if(!r.ok) throw new Error("Network error");
  return await r.json();
 }catch(e){
  alert("Network error: Unable to load data on mobile.");
  throw e;
 }
}

/* DARK MODE */
modeBtn.onclick=()=>{
 document.body.classList.toggle("dark");
 localStorage.setItem("mode",document.body.classList.contains("dark"));
 modeBtn.innerText=document.body.classList.contains("dark")?"â˜€ï¸":"ğŸŒ™";
};
if(localStorage.getItem("mode")==="true"){
 document.body.classList.add("dark");
 modeBtn.innerText="â˜€ï¸";
}

/* INSTALL PWA */
let deferredPrompt;
window.addEventListener("beforeinstallprompt",e=>{
 e.preventDefault();
 deferredPrompt=e;
 installBtn.style.display="block";
});
installBtn.onclick=async()=>{
 if(!deferredPrompt)return;
 deferredPrompt.prompt();
 await deferredPrompt.userChoice;
 installBtn.style.display="none";
 deferredPrompt=null;
};

/* DEFAULT CITY */
window.onload=()=>loadWeather(28.6139,77.209,"Delhi");

/* SEARCH */
async function search(){
 if(!city.value)return;
 const g = await safeFetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city.value}`);
 if(!g.results)return;
 const c=g.results[0];
 loadWeather(c.latitude,c.longitude,c.name);
}

/* WEATHER */
async function loadWeather(lat,lon,name){
 const d = await safeFetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,apparent_temperature,relative_humidity_2m,pressure_msl,windspeed_10m,winddirection_10m,precipitation,precipitation_probability&timezone=auto`);
 temp.innerText=d.current_weather.temperature+"Â°C";
 place.innerText=name;
 renderHourly(d.hourly);
 renderSummary(d.hourly);
 renderLocation(d,lat,lon);
 renderRain(d.hourly);
 detectHeat(d.hourly.temperature_2m.slice(0,24));
 loadAQI(lat,lon);
 loadAstronomy(lat,lon);
}

/* HOURLY */
function renderHourly(h){
 hourly.innerHTML="";
 h.temperature_2m.slice(0,24).forEach((t,i)=>{
  hourly.innerHTML+=`<div class="hour"><span>${new Date(h.time[i]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</span><span>${t}Â°C</span></div>`;
 });
}

/* SUMMARY */
function renderSummary(h){
 const t=h.temperature_2m.slice(0,24);
 summary.innerHTML=`<div class="box">Min<br><b>${Math.min(...t)}Â°C</b></div><div class="box">Max<br><b>${Math.max(...t)}Â°C</b></div><div class="box">Avg<br><b>${(t.reduce((a,b)=>a+b,0)/24).toFixed(1)}Â°C</b></div>`;
}

/* HEAT ALERT */
function detectHeat(t){
 const m=Math.max(...t);
 alertsText.innerHTML=`Max 24h: <b>${m}Â°C</b><br>${m>=45?"ğŸš¨ Severe Heatwave":m>=42?"ğŸ”¥ Heatwave":m>=38?"âš ï¸ Heat Alert":"Normal ğŸŒ¤ï¸"}`;
}

/* RAIN */
function renderRain(h){
 rainBox.innerHTML=`<div class="box">Rain<br><b>${h.precipitation[0]} mm</b></div><div class="box">Chance<br><b>${h.precipitation_probability[0]}%</b></div>`;
}

/* LOCATION CONDITIONS */
function renderLocation(d,lat,lon){
 locationBox.innerHTML=`
<div class="box">Lat<br><b>${lat.toFixed(2)}</b></div>
<div class="box">Lon<br><b>${lon.toFixed(2)}</b></div>
<div class="box">Elev<br><b>${d.elevation} m</b></div>
<div class="box">TZ<br><b>${d.timezone}</b></div>
<div class="box">Temp<br><b>${d.current_weather.temperature}Â°C</b></div>
<div class="box">Feels<br><b>${d.hourly.apparent_temperature[0]}Â°C</b></div>
<div class="box">Humid<br><b>${d.hourly.relative_humidity_2m[0]}%</b></div>
<div class="box">Press<br><b>${d.hourly.pressure_msl[0]}</b></div>
<div class="box">Wind<br><b>${d.current_weather.windspeed}</b></div>
<div class="box">Dir<br><b>${d.hourly.winddirection_10m[0]}Â°</b></div>`;
}

/* AQI */
async function loadAQI(lat,lon){
 const a = await safeFetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=us_aqi,pm2_5,pm10,ozone,nitrogen_dioxide,sulphur_dioxide,carbon_monoxide`);
 const v=a.hourly.us_aqi[0];
 aqiBox.innerHTML=`
<div class="box">AQI<br><b>${v}</b></div>
<div class="box">PM2.5<br><b>${a.hourly.pm2_5[0]}</b></div>
<div class="box">PM10<br><b>${a.hourly.pm10[0]}</b></div>
<div class="box">Oâ‚ƒ<br><b>${a.hourly.ozone[0]}</b></div>
<div class="box">NOâ‚‚<br><b>${a.hourly.nitrogen_dioxide[0]}</b></div>
<div class="box">SOâ‚‚<br><b>${a.hourly.sulphur_dioxide[0]}</b></div>
<div class="box">CO<br><b>${a.hourly.carbon_monoxide[0]}</b></div>`;
}

/* SUN & MOON */
async function loadAstronomy(lat,lon){
 const d = await safeFetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=sunrise,sunset,moon_phase&timezone=auto`);
 const sr=new Date(d.daily.sunrise[0]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
 const ss=new Date(d.daily.sunset[0]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
 const mp=d.daily.moon_phase[0];
 const phase=mp<0.125?"New Moon ğŸŒ‘":mp<0.375?"First Quarter ğŸŒ“":mp<0.625?"Full Moon ğŸŒ•":mp<0.875?"Last Quarter ğŸŒ—":"New Moon ğŸŒ‘";
 astroBox.innerHTML=`
<div class="box">Sunrise<br><b>${sr}</b></div>
<div class="box">Sunset<br><b>${ss}</b></div>
<div class="box">Moon Phase<br><b>${phase}</b></div>
<div class="box">Moon Index<br><b>${mp.toFixed(2)}</b></div>`;
}

/* SAFE SERVICE WORKER */
if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
